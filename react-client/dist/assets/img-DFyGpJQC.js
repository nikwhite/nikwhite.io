import{j as e,r as h,c as y}from"./button-CaKqv1vf.js";function C({onClick:n=()=>window.history.back(),disabled:s=!1}){return e.jsxs("button",{onClick:n,disabled:s,style:{background:"none",border:"none",padding:"8px 16px",cursor:"pointer",marginBottom:"16px",fontSize:"18px"},children:[e.jsx("span",{style:{display:"inline-block",transform:"scaleX(-1)",fontSize:"2em",marginRight:"0.5em",lineHeight:"0",verticalAlign:"middle"},children:"➳"})," back"]})}const P="https://storage.googleapis.com/storage/v1/b/nikwhite.io/o",$=300*1e3,f={prefix:"static/photos/",includeFoldersAsPrefixes:"true",delimiter:"/"},x=new Map;function E(n){const s=x.get(n);return s?Date.now()-s.timestamp>$?(x.delete(n),null):s.data:null}function U(n,s){return x.set(n,{data:s,timestamp:Date.now()}),s}function N(){return new URLSearchParams(window.location.search).get("path")||""}function R(n){return n?`${f.prefix}${n}`:f.prefix}function v(n){const s=new URLSearchParams(f);return s.set("prefix",n),`${P}?${s.toString()}`}async function A(n){const s=E(n);return s||fetch(v(n)).then(i=>i.json()).then(i=>L(n,i)).then(i=>U(n,i))}function L(n,s){const i=[],p=[];if(s.prefixes)for(const l of s.prefixes){const c=l.replace(n,"");c&&i.push({type:"folder",name:c})}if(s.items)for(const l of s.items){const c=l.name.replace(n,"");c&&!c.endsWith("/")&&p.push({name:c,type:"photo",downloadUri:l.mediaLink})}return[...i,...p]}const B=()=>{const[n,s]=h.useState([]),[i,p]=h.useState(!1),[l,c]=h.useState(null),[o,g]=h.useState(N()),j=R(o),m=(t,a)=>{a&&a.preventDefault();const r=new URL(window.location.href);t?r.searchParams.set("path",t):r.searchParams.delete("path"),t!==o&&(window.history.pushState({path:t},"",r.toString()),g(t))};function S(){const t=/\.[a-zA-Z0-9]{2,5}$/.test(o)?-1:-2;return o.split("/").slice(0,t).concat("").join("/")}const w=window.history.state?window.history.back.bind(window.history):m.bind(null,S());if(h.useEffect(()=>{const t=a=>{const r=a.state?.path||"";if(r===o)return a.preventDefault(),!1;g(r)};return window.addEventListener("popstate",t),()=>{window.removeEventListener("popstate",t)}},[]),h.useEffect(()=>{p(!0),c(null),A(j).then(t=>{s(t),p(!1)}).catch(()=>{c("Failed to load photos"),p(!1)})},[j]),o&&!o.endsWith("/")){const t=`https://storage.googleapis.com/nikwhite.io/static/photos/${o}`;return e.jsxs("section",{className:"photo-view",children:[e.jsx("div",{children:e.jsx(C,{onClick:w})}),e.jsx("img",{src:t,alt:o})]})}return e.jsxs("section",{className:"photo-browser",children:[e.jsxs("h2",{className:"breadcrumb",children:[e.jsx("a",{href:"?",onClick:t=>m("",t),children:"nikwhite.io"}),o&&o.split("/").filter(Boolean).map((t,a,r)=>{const d=r.slice(0,a+1).join("/")+"/",u=`?path=${encodeURIComponent(d)}`;return e.jsxs("span",{children:[e.jsx("span",{className:"breadcrumb-separator",children:" > "}),e.jsx("a",{href:u,onClick:b=>m(d,b),children:t})]},a)})]}),i&&e.jsx("p",{children:"Loading..."}),l&&e.jsx("p",{style:{color:"red"},children:l}),e.jsxs("ul",{className:"item-list",children:[n.map((t,a)=>{if(t.type==="folder"){const r=o?`${o}${t.name}`:t.name,d=`?path=${encodeURIComponent(r)}`;return e.jsx("li",{className:"item-list-item",children:e.jsxs("a",{href:d,className:"item-link",onClick:u=>m(r,u),children:[e.jsx("span",{className:"folder-icon",children:"➳"}),t.name]})},a)}else{const r=o?`${o}${t.name}`:t.name,d=`?path=${encodeURIComponent(r)}`;return e.jsx("li",{className:"item-list-item",children:e.jsx("a",{href:d,className:"item-link",onClick:u=>m(r,u),children:t.name})},a)}}),e.jsx("li",{className:"item-list-item",children:e.jsx(C,{onClick:w})})]})]})},D=()=>e.jsxs("div",{style:{padding:"8px 16px 16px",fontFamily:"Arial, sans-serif"},children:[e.jsx("h1",{children:"Photos"}),e.jsx(B,{})]}),k=document.getElementById("root");k?y.createRoot(k).render(e.jsx(h.StrictMode,{children:e.jsx(D,{})})):console.error("Container element not found.");
