import{j as e,r as d,c as I}from"./button-CaKqv1vf.js";function y({onClick:n=()=>window.history.back(),disabled:s=!1}){return e.jsxs("button",{onClick:n,disabled:s,style:{background:"none",border:"none",padding:"8px 16px",cursor:"pointer",marginBottom:"16px",fontSize:"18px"},children:[e.jsx("span",{style:{display:"inline-block",transform:"scaleX(-1)",fontSize:"2em",marginRight:"0.5em",lineHeight:"0",verticalAlign:"middle"},children:"➳"})," back"]})}const L="https://storage.googleapis.com/storage/v1/b/nikwhite.io/o",B="https://storage.googleapis.com/nikwhite.io/static/photos/",T=300*1e3,j={prefix:"static/photos/",includeFoldersAsPrefixes:"true",delimiter:"/"},w=new Map;function U(n){const s=w.get(n);return s?Date.now()-s.timestamp>T?(w.delete(n),null):s.data:null}function D(n,s){return w.set(n,{data:s,timestamp:Date.now()}),s}function _(){return new URLSearchParams(window.location.search).get("path")||""}function N(n){return n?`${j.prefix}${n}`:j.prefix}function F(n){const s=new URLSearchParams(j);return s.set("prefix",n),`${L}?${s.toString()}`}async function $(n){const s=U(n);return s||fetch(F(n)).then(i=>i.json()).then(i=>H(n,i)).then(i=>D(n,i))}function H(n,s){const i=[],m=[];if(s.prefixes)for(const p of s.prefixes){const h=p.replace(n,"");h&&i.push({type:"folder",name:h})}if(s.items)for(const p of s.items){const h=p.name.replace(n,"");h&&!h.endsWith("/")&&m.push({name:h,type:"photo",downloadUri:p.mediaLink})}return[...i,...m]}const M=()=>{const[n,s]=d.useState([]),[i,m]=d.useState(!1),[p,h]=d.useState(null),[r,C]=d.useState(_()),P=N(r),u=(t,a)=>{a&&a.preventDefault();const o=new URL(window.location.href);t?o.searchParams.set("path",t):o.searchParams.delete("path"),t!==r&&(window.history.pushState({path:t},"",o.toString()),C(t))};function k(){const t=/\.[a-zA-Z0-9]{2,5}$/.test(r)?-1:-2;return r.split("/").slice(0,t).concat("").join("/")}const S=window.history.state?()=>window.history.back():()=>u(k());d.useEffect(()=>{const t=a=>{const o=a.state?.path||"";if(o===r)return a.preventDefault(),!1;C(o)};return window.addEventListener("popstate",t),()=>{window.removeEventListener("popstate",t)}},[]),d.useEffect(()=>{m(!0),h(null),$(P).then(t=>{s(t),m(!1)}).catch(()=>{h("Failed to load photos"),m(!1)})},[P]);const b=async t=>{const a=k(),o=N(a);let l=U(o);l||(l=await $(o));const c=l.filter(g=>g.type==="photo");if(c.length===0)return;const f=r.split("/").pop()||"",x=c.findIndex(g=>g.name===f);if(x===-1)return;const A=t==="next"?(x+1)%c.length:(x-1+c.length)%c.length,v=c[A],R=a?`${a}${v.name}`:v.name;u(R)};if(r&&!r.endsWith("/")){const t=`${B}${r}`;return e.jsxs("section",{className:"photo-view",children:[e.jsxs("div",{className:"photo-controls",children:[e.jsx(y,{onClick:S}),e.jsxs("button",{className:"nav-button",onClick:()=>b("prev"),children:[e.jsx("span",{className:"nav-icon prev-icon",children:"➳"})," previous"]}),e.jsxs("button",{className:"nav-button",onClick:()=>b("next"),children:["next ",e.jsx("span",{className:"nav-icon next-icon",children:"➳"})]})]}),e.jsx("img",{src:t})]})}return e.jsxs("section",{className:"photo-browser",children:[e.jsxs("h2",{className:"breadcrumb",children:[e.jsx("a",{href:"?",onClick:t=>u("",t),children:"nikwhite.io"}),r&&r.split("/").filter(Boolean).map((t,a,o)=>{const l=o.slice(0,a+1).join("/")+"/",c=`?path=${encodeURIComponent(l)}`;return e.jsxs("span",{children:[e.jsx("span",{className:"breadcrumb-separator",children:" > "}),e.jsx("a",{href:c,onClick:f=>u(l,f),children:t})]},a)})]}),i&&e.jsx("p",{children:"Loading..."}),p&&e.jsx("p",{style:{color:"red"},children:p}),e.jsxs("ul",{className:"item-list",children:[n.map((t,a)=>{if(t.type==="folder"){const o=r?`${r}${t.name}`:t.name,l=`?path=${encodeURIComponent(o)}`;return e.jsx("li",{className:"item-list-item",children:e.jsxs("a",{href:l,className:"item-link",onClick:c=>u(o,c),children:[e.jsx("span",{className:"folder-icon",children:"➳"}),t.name]})},a)}else{const o=r?`${r}${t.name}`:t.name,l=`?path=${encodeURIComponent(o)}`;return e.jsx("li",{className:"item-list-item",children:e.jsx("a",{href:l,className:"item-link",onClick:c=>u(o,c),children:t.name})},a)}}),e.jsx("li",{className:"item-list-item",children:e.jsx(y,{onClick:S})})]})]})},z=()=>e.jsxs("div",{style:{padding:"8px 16px 16px",fontFamily:"Arial, sans-serif"},children:[e.jsx("h1",{children:"Photos"}),e.jsx(M,{})]}),E=document.getElementById("root");E?I.createRoot(E).render(e.jsx(d.StrictMode,{children:e.jsx(z,{})})):console.error("Container element not found.");
